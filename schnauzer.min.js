!function(t,r){"object"==typeof exports?module.exports=r(t):"function"==typeof define&&define.amd?define("schnauzer",[],function(){return r(t)}):t.Schnauzer=r(t)}(this,function(t,r,n){"use strict";function e(t,r){var n="{{"===r[0],e=n?["{{2,3}","}{2,3}"]:r;t.options.tags=e,t.variableRegExp=new RegExp("("+e[0]+")([>!&=]\\s*)*([\\w\\"+t.options.characters+"\\.\\s*]+)*"+e[1],"g"),t.sectionRegExp=new RegExp(e[0]+"(#|\\^)([\\w\\.]*)\\s*(.*?)"+e[1]+"([\\S\\s]*?)("+e[0]+")\\/\\2("+e[1]+")","g")}function i(t){return t&&t.constructor===Array}function s(t){return t&&"function"==typeof t}function o(t,r){for(var n=0,e=r.length;e>n;n++)t=t&&t[r[n]];return t}function p(t,n,e){if("string"==typeof e){var i=[],s=t[e]!==r?t[e]:o(t,i=e.split("."));if(s!==r)return s;for(var p=n.length;p--;){if(n[p][e]!==r)return n[p][e];if(s=o(n[p],i))return s}}}function a(t,r){return String(t).replace(r.entityRegExp,function(t){return r.options.entityMap[t]})}function u(t,r,n){return{getData:function(t){return p(r,n,t)},escapeHtml:function(r){return a(r,t)}}}function c(t,n){var e=[],i=t.options;return n=n.replace(t.variableRegExp,function(r,n,s,o){var p=s&&("!"===s[0]||"="===s[0]),a=!i.doEscape||"{{{"===n||s&&"&"===s[0],u=s&&">"===s[0],c=!1,l="",f={};if(p)return"";if(o=o.split(/\s+/),l=o.shift(o),u)for(var g=o.length,h=[];g--;)h=o[g].split("="),f[h[1]?h[0]:"$"+g]=(h[1]?h[1]:h[0]).replace(/"/g,"");return c=l===i.recursion,e.push(u&&(t.partials[l]||c)?[t.partials[l],f,u,a,c]:[l,o,null,a]),i.splitter}).split(i.splitter),function(o,c,l){l&&(c=[l].concat(c));for(var f,g,h=0,v=n.length,x="";v>h;h++)x+=n[h],e[h]!==r&&(g=e[h][0],e[h][2]===!0?f=(g||t.partials[i.recursion])(o,e[h][4]?null:c,e[h][1]):(f=o[g]!==r?o[g]:p(o,c,g),f=i.helpers[g]?i.helpers[g].apply(u(t,o,c),[""].concat(e[h][1])):s(f)?f.apply(u(t,o,c),[""].concat(e[h][1])):g.isExecutor?g(o,c):f&&(e[h][3]?f:a(f,t))),f!==r&&(x+=f));return x}}function l(t,r,n,e,o){return function(a,c,l){var f=p(a,c,n);if(i(f)){if(o)return f.length?"":r(f,c);for(var g=0,h=f.length,v="";h>g;g++)v+="object"==typeof f[g]?r(f[g],[f[g]].concat(a,c)):r({".":f[g]},c);return v}return t.options.helpers[n]?t.options.helpers[n].apply(u(t,a,c),[r(a,c)].concat(e.split(/\s+/))):(l=a[n]||f,l&&s(l)?l.apply(u(t,a,c),[r(a,c)].concat(e.split(/\s+/))):o&&!l||!o&&l?r(a,c):void 0)}}function f(t,r){for(var e=t.options,i=[],o=[],p=[],a=-1,u="",g=r.replace(t.sectionRegExp,function(r,s,o,g,h,v,x){var y=v+s+o,E=h.lastIndexOf(y);return p.length?r:(a++,-1!==E?(p.push(a--),u=Array(++n).join("."),y+g+x+h.substring(0,E)+v+s+u+o+h.substring(E+y.length)+v+"/"+u+o+x):(o=o.replace(t.stopRegExp,""),i.push(new RegExp(e.tags[0]+"[#^]").test(h)?l(t,f(t,h),o,g,"^"===s):l(t,c(t,h),o,g,"^"===s)),e.splitter))}).split(e.splitter),h=0,v=p.length;v>h;h++)g[p[h]]=f(t,g[p[h]]);for(var h=0,v=g.length;v>h;h++)o.push(s(g[h])?g[h]:c(t,g[h])),i[h]&&o.push(i[h]);return function x(t,r,n){x.isExecutor=!0;for(var e=0,i=o.length,s="";i>e;e++)s+=o[e](t,r||[t],n)||"";return s}}var g=function(t,r){this.version="0.1.0",this.options={tags:["{{","}}"],entityMap:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},doEscape:!0,helpers:{},partials:{},recursion:"self",characters:'$"<>%-=@',splitter:"|##|"},h(this,r||{},t)},h=function(t,r,i){for(var s in r)t.options[s]=r[s];n=1,r=t.options,t.entityRegExp=function(t,r){for(var n in t)r+=n;return new RegExp("["+r+"]","g")}(r.entityMap,[]),t.stopRegExp=new RegExp(/^\.+/),e(t,r.tags),t.partials={};for(var o in r.partials)t.registerPartial(o,r.partials[o]);i&&t.registerPartial(r.recursion,i)};return g.prototype={render:function(t,r){return r=r&&(i(r)&&r||[r]),this.partials[this.options.recursion](t,r)},parse:function(t){this.partials[this.options.recursion]||this.registerPartial(this.options.recursion,t)},registerHelper:function(t,r){this.options.helpers[t]=r},unregisterHelper:function(t){delete this.options.helpers[t]},registerPartial:function(t,r){return this.partials[t]=f(this,r)},unregisterPartial:function(t){delete this.options.partials[t]},setTags:function(t){e(this,t)}},g});