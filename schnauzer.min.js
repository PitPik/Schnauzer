!function(t,r){"object"==typeof exports?module.exports=r(t):"function"==typeof define&&define.amd?define("Schnauzer",[],function(){return r(t)}):t.Schnauzer=r(t)}(this,function(t,r){"use strict";function n(t,r){var n="{{"===r[0],e=n?["{{2,3}","}{2,3}"]:r;t.options.tags=e,t.variableRegExp=new RegExp("("+e[0]+")([>!&=]\\s*)*([\\w\\"+t.options.characters+"\\.\\s*]+)*"+e[1],"g"),t.sectionRegExp=new RegExp(e[0]+"(#|\\^)([\\w\\.]*)\\s*(.*?)"+e[1]+"([\\S\\s]*?)("+e[0]+")\\/\\2("+e[1]+")","g")}function e(t){return t&&t.constructor===Array}function i(t,r){for(var n=0,e=r.length;e>n;n++)t=t&&t[r[n]];return t}function s(t,n,e){if("string"==typeof e){var s=[],o=t[e]!==r?t[e]:i(t,s=e.split("."));if(o!==r)return o;for(var p=n.length;p--;){if(n[p][e]!==r)return n[p][e];if(o=i(n[p],s))return o}}}function o(t,r){return String(t).replace(r.entityRegExp,function(t){return r.options.entityMap[t]})}function p(t,r,n){return{getData:function(t){return s(r,n,t)},escapeHtml:function(r){return o(r,t)}}}function a(t,n){var e=[],i=t.options;return n=n.replace(t.variableRegExp,function(r,n,s,o){var p=s&&("!"===s[0]||"="===s[0]),a=!i.doEscape||"{{{"===n||s&&"&"===s[0],u=s&&">"===s[0],c=!1,l="",f={};if(p)return"";if(o=o.split(/\s+/),l=o.shift(o),u)for(var g=o.length,h=[];g--;)h=o[g].split("="),f[h[1]?h[0]:"$"+g]=(h[1]?h[1]:h[0]).replace(/"/g,"");return c=l===i.recursion,e.push(u&&(t.partials[l]||c)?[t.partials[l],f,u,a,c]:[l,o,null,a]),i.splitter}).split(i.splitter),function(a,u,c){c&&(u=[c].concat(u));for(var l,f,g=0,h=n.length,v="";h>g;g++)v+=n[g],e[g]!==r&&(f=e[g][0],e[g][2]===!0?l=(f||t.partials[i.recursion])(a,e[g][4]?null:u,e[g][1]):(l=a[f]!==r?a[f]:s(a,u,f),l=i.helpers[f]?i.helpers[f].apply(p(t,a,u),[""].concat(e[g][1])):"function"==typeof l?l.apply(p(t,a,u),[""].concat(e[g][1])):"executor"===f.name?f(a,u):l&&(e[g][3]?l:o(l,t))),l!==r&&(v+=l));return v}}function u(t,r,n,i,o){return function(a,u,c){if(e(a[n])){if(a=a[n],o)return a.length?"":r(a,u);for(var l=0,f=a.length,g="";f>l;l++)g+="object"==typeof a[l]?r(a[l],[a[l]].concat(u)):r({".":a[l]},u);return g}return t.options.helpers[n]?t.options.helpers[n].apply(p(t,a,u),[r(a,u)].concat(i.split(/\s+/))):(c=a[n]||s(a,u,n),c&&"function"==typeof c?c.apply(p(t,a,u),[r(a,u)].concat(i.split(/\s+/))):o&&!c||!o&&c?r(a,u):void 0)}}function c(t,r){for(var n=t.options,e=[],i=[],s=[],o=-1,p=n.stopper,l=p+"\\d+"+p,f=r.replace(t.sectionRegExp,function(r,i,f,h,v,x,y){var d=x+i+f+h+y,E=v.lastIndexOf(d);return o++,-1!==E?(s.push(o--),d+v.substring(0,E)+x+i+f+p+g+p+y+v.substring(E+d.length)+x+"/"+f+p+g++ +p+y):(f=f.replace(new RegExp(l),""),e.push(new RegExp(n.tags[0]+"[#^]").test(v)?u(t,c(t,v),f,h):u(t,a(t,v),f,h,"^"===i)),n.splitter)}).split(n.splitter),h=0,v=s.length;v>h;h++)f[s[h]]=c(t,f[s[h]]);for(var h=0,v=f.length;v>h;h++)i.push("function"==typeof f[h]?f[h]:a(t,f[h])),e[h]&&i.push(e[h]);return function(t,r,n){for(var e=0,s=i.length,o="";s>e;e++)o+=i[e](t,r||[t],n)||"";return o}}var l=function(t,r){this.version="0.1.0",this.options={tags:["{{","}}"],entityMap:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},doEscape:!0,helpers:{},partials:{},recursion:"self",characters:'$"<>%=@',splitter:"|##|",stopper:"__"},f(this,r||{},t)},f=function(t,r,e){for(var i in r)t.options[i]=r[i];r=t.options,t.entityRegExp=function(t,r){for(var n in t)r+=n;return new RegExp("["+r+"]","g")}(r.entityMap,[]),n(t,r.tags),t.partials={};for(var s in r.partials)t.registerPartial(s,r.partials[s]);e&&t.registerPartial(r.recursion,e)},g=0;return l.prototype={render:function(t){return this.partials[this.options.recursion](t)},parse:function(t){this.partials[this.options.recursion]||this.registerPartial(this.options.recursion,t)},registerHelper:function(t,r){this.options.helpers[t]=r},unregisterHelper:function(t){delete this.options.helpers[t]},registerPartial:function(t,r){return this.partials[t]=c(this,r)},unregisterPartial:function(t){delete this.options.partials[t]},setTags:function(t){n(this,t)}},l});