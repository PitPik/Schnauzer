!function(t,r){"object"==typeof exports?module.exports=r(t):"function"==typeof define&&define.amd?define("schnauzer",[],function(){return r(t)}):t.Schnauzer=r(t)}(this,function(t,v,d){"use strict";var r=function(t,r){this.version="0.1.0",this.options={tags:["{{","}}"],entityMap:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},doEscape:!0,helpers:{},partials:{},recursion:"self",characters:'$"<>%-=@',splitter:"|##|"},e(this,r||{},t)},e=function(t,r,e){for(var n in r)t.options[n]=r[n];for(var i in d=1,r=t.options,t.entityRegExp=function(t,r){for(var e in t)r+=e;return new RegExp("["+r+"]","g")}(r.entityMap,[]),t.stopRegExp=new RegExp(/^\°+/),s(t,r.tags),t.partials={},r.partials)t.registerPartial(i,r.partials[i]);e&&t.registerPartial(r.recursion,e)};return r.prototype={render:function(t,r){return this.partials[this.options.recursion](y(t,r))},parse:function(t){this.partials[this.options.recursion]||this.registerPartial(this.options.recursion,t)},registerHelper:function(t,r){this.options.helpers[t]=r},unregisterHelper:function(t){delete this.options.helpers[t]},registerPartial:function(t,r){return this.partials[t]=function u(l,t){var c=l.options,f=[],s=[],h=[],g=-1,x="",r=t.replace(l.sectionRegExp,function(t,r,e,n,i,s,a){var o=s+r+e,p=i.lastIndexOf(o);return h.length?t:(g++,-1!==p?(h.push(g--),x=Array(++d).join("°"),o+n+a+i.substring(0,p)+s+r+x+e+i.substring(p+o.length)+s+"/"+x+e+a):(e=e.replace(l.stopRegExp,""),f.push(new RegExp(c.tags[0]+"[#^]").test(i)?P(l,u(l,i),e,n,"^"===r):P(l,b(l,i),e,n,"^"===r)),c.splitter))}).split(c.splitter);for(var e=0,n=h.length;e<n;e++)r[h[e]]=u(l,r[h[e]]);for(var e=0,n=r.length;e<n;e++)s.push(E(r[e])?r[e]:b(l,r[e])),f[e]&&s.push(f[e]);return function(t,r){if(!t.__schnauzer)return l.render(t);for(var e=0,n=s.length,i="";e<n;e++)i+=s[e](t,r)||"";return i}}(this,r)},unregisterPartial:function(t){delete this.options.partials[t]},setTags:function(t){s(this,t)}},r;function s(t,r){var e=t.options.tags="{{"===r[0]?["{{2,3}","}{2,3}"]:r,n=t.options.characters;t.variableRegExp=new RegExp("("+e[0]+")([>!&=]\\s*)*([\\w\\"+n+"\\.\\s*]+)*"+e[1],"g"),t.sectionRegExp=new RegExp(e[0]+"(#|\\^)([\\w"+n+"]*)\\s*(.*?)"+e[1]+"([\\S\\s]*?)("+e[0]+")\\/\\2("+e[1]+")","g")}function E(t){return t&&"function"==typeof t}function y(t,r,e,n,i){return{data:e||t.data||t,extra:r&&[].concat(r)||t.extra||[],path:[].concat(t.path!==v?t.path:t,n||[]),helpers:i||{},__schnauzer:!0}}function u(t,r){for(var e=0,n=r.length;e<n;e++)t=t&&t[r[e]];return t}function R(t,r,e,n){if("string"==typeof r){var i=[],s=t.path.length-1-(0<=n?n:0),a=0<=n&&0<=s?t.path[s]:t.data,o=t.helpers[r]!==v?t.helpers[r]:a&&a[r]!==v?a[r]:u(a,i=e||r.split("."));if(o!==v)return o;for(var p=t.extra.length;p--;){if(t.extra[p][r]!==v)return t.extra[p][r];if((o=u(t.extra[p],i))!==v)return o}}}function l(t,r){return String(t).replace(r.entityRegExp,function(t){return r.options.entityMap[t]})}function w(r,e,t){return{getData:function(t){return R(e,t)},escapeHtml:function(t){return l(t,r)}}}function b(h,p){var g=[],x=h.options;return p=p.replace(h.variableRegExp,function(t,r,e,n){var i,s=e&&("!"===e[0]||"="===e[0]),a=!x.doEscape||"{{{"===r||e&&"&"===e[0],o=e&&">"===e[0],p="",u=[],l={};if(s)return"";if(p=(u=(p=(n=n.split(/\s+/)).shift(n)).split("../")).pop(),o)for(var c=n.length,f=[];c--;)l[(f=n[c].split("="))[1]?f[0]:"$"+c]=(f[1]?f[1]:f[0]).replace(/"/g,"");return i=p===x.recursion,g.push(o&&(h.partials[p]||i)?[h.partials[p],l,o,a,i]:[p,n,null,a,null,u.length]),x.splitter}).split(x.splitter),function(t,r){r&&(t=y(t,v,r));for(var e,n,i=0,s=p.length,a="";i<s;i++)if(a+=p[i],g[i]!==v){if(n=g[i][0],!0===g[i][2])e=(n||h.partials[x.recursion])(t,g[i][4]?null:t,g[i][1]);else{e=t.data[n]!==v?t.data[n]:R(t,n,null,g[i][5]);var o=x.helpers[n]||E(e)&&e;e=o?o.apply(w(h,t),[].concat(g[i][1])):n.isExecutor?n(t):e&&(g[i][3]?e:l(e,h))}e!==v&&(a+=e)}return a}}function P(l,c,t,f,h){var r=t.split("../"),g=r.pop(),x=r.length;return function(t){var r,e=R(t,g,null,x);if((r=e)&&r.constructor===Array){if(h)return e.length?"":c(e);for(var n=0,i=e.length,s="";n<i;n++){var a={"@index":""+n,"@last":n===i-1,"@fist":!n,".":e[n]};t=y(t,v,e[n],e[n],a),s+=c(t),t.path.pop()}return s}var o="object"==typeof e,p=o?e:t,u=l.options.helpers[g]||E(p)&&p;return u?u.apply(w(l,t),[c(t)].concat(f.split(/\s+/))):h&&!e||!h&&e?c(y(t,t.extra,p,o?p:[])):void 0}}});