!function(t,r){"object"==typeof exports?module.exports=r(t):"function"==typeof define&&define.amd?define("schnauzer",[],function(){return r(t)}):t.Schnauzer=r(t)}(this,function(t,r){"use strict";function n(t,r){var n="{{"===r[0],e=n?["{{2,3}","}{2,3}"]:r;t.options.tags=e,t.variableRegExp=new RegExp("("+e[0]+")([>!&=]\\s*)*([\\w\\"+t.options.characters+"\\.\\s*]+)*"+e[1],"g"),t.sectionRegExp=new RegExp(e[0]+"(#|\\^)([\\w\\.]*)\\s*(.*?)"+e[1]+"([\\S\\s]*?)("+e[0]+")\\/\\2("+e[1]+")","g")}function e(t){return t&&t.constructor===Array}function i(t){return t&&"function"==typeof t}function s(t,r){for(var n=0,e=r.length;e>n;n++)t=t&&t[r[n]];return t}function o(t,n,e){if("string"==typeof e){var i=[],o=t[e]!==r?t[e]:s(t,i=e.split("."));if(o!==r)return o;for(var p=n.length;p--;){if(n[p][e]!==r)return n[p][e];if(o=s(n[p],i))return o}}}function p(t,r){return String(t).replace(r.entityRegExp,function(t){return r.options.entityMap[t]})}function a(t,r,n){return{getData:function(t){return o(r,n,t)},escapeHtml:function(r){return p(r,t)}}}function u(t,n){var e=[],s=t.options;return n=n.replace(t.variableRegExp,function(r,n,i,o){var p=i&&("!"===i[0]||"="===i[0]),a=!s.doEscape||"{{{"===n||i&&"&"===i[0],u=i&&">"===i[0],c=!1,l="",f={};if(p)return"";if(o=o.split(/\s+/),l=o.shift(o),u)for(var g=o.length,h=[];g--;)h=o[g].split("="),f[h[1]?h[0]:"$"+g]=(h[1]?h[1]:h[0]).replace(/"/g,"");return c=l===s.recursion,e.push(u&&(t.partials[l]||c)?[t.partials[l],f,u,a,c]:[l,o,null,a]),s.splitter}).split(s.splitter),function(u,c,l){l&&(c=[l].concat(c));for(var f,g,h=0,v=n.length,x="";v>h;h++)x+=n[h],e[h]!==r&&(g=e[h][0],e[h][2]===!0?f=(g||t.partials[s.recursion])(u,e[h][4]?null:c,e[h][1]):(f=u[g]!==r?u[g]:o(u,c,g),f=s.helpers[g]?s.helpers[g].apply(a(t,u,c),[""].concat(e[h][1])):i(f)?f.apply(a(t,u,c),[""].concat(e[h][1])):"executor"===g.name?g(u,c):f&&(e[h][3]?f:p(f,t))),f!==r&&(x+=f));return x}}function c(t,r,n,s,p){return function(u,c,l){var f=o(u,c,n);if(e(f)){if(p)return f.length?"":r(f,c);for(var g=0,h=f.length,v="";h>g;g++)v+="object"==typeof f[g]?r(f[g],[f[g]].concat(u)):r({".":f[g]},c);return v}return t.options.helpers[n]?t.options.helpers[n].apply(a(t,u,c),[r(u,c)].concat(s.split(/\s+/))):(l=u[n]||f,l&&i(l)?l.apply(a(t,u,c),[r(u,c)].concat(s.split(/\s+/))):p&&!l||!p&&l?r(u,c):void 0)}}function l(t,r){for(var n=t.options,e=[],s=[],o=[],p=-1,a=n.stopper,f=a+"\\d+"+a,g=r.replace(t.sectionRegExp,function(r,i,s,g,v,x,y){var d=x+i+s+g+y,E=v.lastIndexOf(d);return o.length?r:(p++,-1!==E?(o.push(p--),d+v.substring(0,E)+x+i+s+a+h+a+y+v.substring(E+d.length)+x+"/"+s+a+h++ +a+y):(s=s.replace(new RegExp(f),""),e.push(new RegExp(n.tags[0]+"[#^]").test(v)?c(t,l(t,v),s,g,"^"===i):c(t,u(t,v),s,g,"^"===i)),n.splitter))}).split(n.splitter),v=0,x=o.length;x>v;v++)g[o[v]]=l(t,g[o[v]]);for(var v=0,x=g.length;x>v;v++)s.push(i(g[v])?g[v]:u(t,g[v])),e[v]&&s.push(e[v]);return function(t,r,n){for(var e=0,i=s.length,o="";i>e;e++)o+=s[e](t,r||[t],n)||"";return o}}var f=function(t,r){this.version="0.1.0",this.options={tags:["{{","}}"],entityMap:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},doEscape:!0,helpers:{},partials:{},recursion:"self",characters:'$"<>%-=@',splitter:"|##|",stopper:"__"},g(this,r||{},t)},g=function(t,r,e){for(var i in r)t.options[i]=r[i];r=t.options,t.entityRegExp=function(t,r){for(var n in t)r+=n;return new RegExp("["+r+"]","g")}(r.entityMap,[]),n(t,r.tags),t.partials={};for(var s in r.partials)t.registerPartial(s,r.partials[s]);e&&t.registerPartial(r.recursion,e)},h=0;return f.prototype={render:function(t,r){return r=r&&(e(r)&&r||[r]),this.partials[this.options.recursion](t,r)},parse:function(t){this.partials[this.options.recursion]||this.registerPartial(this.options.recursion,t)},registerHelper:function(t,r){this.options.helpers[t]=r},unregisterHelper:function(t){delete this.options.helpers[t]},registerPartial:function(t,r){return this.partials[t]=l(this,r)},unregisterPartial:function(t){delete this.options.partials[t]},setTags:function(t){n(this,t)}},f});