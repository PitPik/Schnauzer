!function(t,r){"object"==typeof exports?module.exports=r(t):"function"==typeof define&&define.amd?define("schnauzer",[],function(){return r(t)}):t.Schnauzer=r(t)}(this,function(t,r,n){"use strict";var e=function(t,r){this.version="0.1.0",this.options={tags:["{{","}}"],entityMap:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},doEscape:!0,helpers:{},partials:{},recursion:"self",characters:'$"<>%-=@',splitter:"|##|"},i(this,r||{},t)},i=function(t,r,e){for(var i in r)t.options[i]=r[i];for(var o in n=1,r=t.options,t.entityRegExp=function(t,r){for(var n in t)r+=n;return new RegExp("["+r+"]","g")}(r.entityMap,[]),t.stopRegExp=new RegExp(/^\.+/),s(t,r.tags),t.partials={},r.partials)t.registerPartial(o,r.partials[o]);e&&t.registerPartial(r.recursion,e)};return e.prototype={render:function(t,r){return r=r&&(o(r)&&r||[r]),this.partials[this.options.recursion](t,r)},parse:function(t){this.partials[this.options.recursion]||this.registerPartial(this.options.recursion,t)},registerHelper:function(t,r){this.options.helpers[t]=r},unregisterHelper:function(t){delete this.options.helpers[t]},registerPartial:function(t,r){return this.partials[t]=function t(r,e){var i=r.options,s=[],o=[],a=[],u=-1,c="",l=e.replace(r.sectionRegExp,function(e,o,p,l,h,v,x){var y=v+o+p,E=h.lastIndexOf(y);return a.length?e:(u++,-1!==E?(a.push(u--),c=Array(++n).join("."),y+l+x+h.substring(0,E)+v+o+c+p+h.substring(E+y.length)+v+"/"+c+p+x):(p=p.replace(r.stopRegExp,""),s.push(new RegExp(i.tags[0]+"[#^]").test(h)?g(r,t(r,h),p,l,"^"===o):g(r,f(r,h),p,l,"^"===o)),i.splitter))}).split(i.splitter);for(var h=0,v=a.length;h<v;h++)l[a[h]]=t(r,l[a[h]]);for(var h=0,v=l.length;h<v;h++)o.push(p(l[h])?l[h]:f(r,l[h])),s[h]&&o.push(s[h]);return function t(r,n,e){t.isExecutor=!0;for(var i=0,s=o.length,p="";i<s;i++)p+=o[i](r,n||[r],e)||"";return p}}(this,r)},unregisterPartial:function(t){delete this.options.partials[t]},setTags:function(t){s(this,t)}},e;function s(t,r){var n="{{"===r[0]?["{{2,3}","}{2,3}"]:r;t.options.tags=n,t.variableRegExp=new RegExp("("+n[0]+")([>!&=]\\s*)*([\\w\\"+t.options.characters+"\\.\\s*]+)*"+n[1],"g"),t.sectionRegExp=new RegExp(n[0]+"(#|\\^)([\\w\\.]*)\\s*(.*?)"+n[1]+"([\\S\\s]*?)("+n[0]+")\\/\\2("+n[1]+")","g")}function o(t){return t&&t.constructor===Array}function p(t){return t&&"function"==typeof t}function a(t,r){for(var n=0,e=r.length;n<e;n++)t=t&&t[r[n]];return t}function u(t,n,e){if("string"==typeof e){var i=[],s=t[e]!==r?t[e]:a(t,i=e.split("."));if(s!==r)return s;for(var o=n.length;o--;){if(n[o][e]!==r)return n[o][e];if(s=a(n[o],i))return s}}}function c(t,r){return String(t).replace(r.entityRegExp,function(t){return r.options.entityMap[t]})}function l(t,r,n){return{getData:function(t){return u(r,n,t)},escapeHtml:function(r){return c(r,t)}}}function f(t,n){var e=[],i=t.options;return n=n.replace(t.variableRegExp,function(r,n,s,o){var p,a,u=s&&("!"===s[0]||"="===s[0]),c=!i.doEscape||"{{{"===n||s&&"&"===s[0],l=s&&">"===s[0],f={};if(u)return"";if(a=(o=o.split(/\s+/)).shift(o),l)for(var g=o.length,h=[];g--;)f[(h=o[g].split("="))[1]?h[0]:"$"+g]=(h[1]?h[1]:h[0]).replace(/"/g,"");return p=a===i.recursion,e.push(l&&(t.partials[a]||p)?[t.partials[a],f,l,c,p]:[a,o,null,c]),i.splitter}).split(i.splitter),function(s,o,a){a&&(o=[a].concat(o));for(var f,g,h=0,v=n.length,x="";h<v;h++)x+=n[h],e[h]!==r&&(g=e[h][0],!0===e[h][2]?f=(g||t.partials[i.recursion])(s,e[h][4]?null:o,e[h][1]):(f=s[g]!==r?s[g]:u(s,o,g),f=i.helpers[g]?i.helpers[g].apply(l(t,s,o),[""].concat(e[h][1])):p(f)?f.apply(l(t,s,o),[""].concat(e[h][1])):g.isExecutor?g(s,o):f&&(e[h][3]?f:c(f,t))),f!==r&&(x+=f));return x}}function g(t,r,n,e,i){return function(s,a,c){var f=u(s,a,n);if(o(f)){if(i)return f.length?"":r(f,a);for(var g=0,h=f.length,v="";g<h;g++)v+="object"==typeof f[g]?r(f[g],[f[g]].concat(s,a,{"@index":g})):r({".":f[g],"@index":g},a);return v}return t.options.helpers[n]?t.options.helpers[n].apply(l(t,s,a),[r(s,a)].concat(e.split(/\s+/))):(c=s[n]||f)&&p(c)?c.apply(l(t,s,a),[r(s,a)].concat(e.split(/\s+/))):i&&!c||!i&&c?r(s,a):void 0}}});