<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

	<style type="text/css">
		body {
			color: rgba(0, 0, 0, 0.87);
			font: normal normal normal .90em/1.6em "Trebuchet MS", Arial, Helvetica, sans-serif;
			padding: 1em;
		}
		h1 {
			font-size: 20px;
			font-weight: 700;
			line-height: 1.25;
		}
		h2 {
			font-size: 16px;
			margin-bottom: 5px;
			color: #582a00;
		}
		a {
			color: #6666cc;
			text-decoration: none;
		}
		a:hover {
			text-decoration: underline;
		}
		.break-line {
			margin: 2em 0 1em;
			color: #404092;
		}
		button {
			font: normal normal normal .90em/1.6em "Trebuchet MS", Arial, Helvetica, sans-serif;
			border-radius: 3px;
			padding: .4em;
		}
	</style>

	<script type="text/javascript" src="schnauzer.js"></script>
	<script type="text/javascript" src="handlebars.js"></script>
	<title>Handlebars facade tests</title>
</head>
<body>
<h1>The following examples are taken from <a href="http://tryhandlebarsjs.com/">http://tryhandlebarsjs.com/</a></h1>
<br>
<div id="container"></div>

<script type="text/javascript">
var template = '';
var context = {};
var handlebars = function() {};
var container = document.querySelector('#container');


container.innerHTML += '<div class="break-line">------ handlebar expression ------</div>';

template = `<div class="entry">
	<h1>{{title}}</h1>
	<div class="body">
		{{body}}
	</div>
</div>`;

context = {
	title: "My New Post",
	body: "This is my first post!"
};

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);

container.innerHTML += '<div class="break-line">------ expression with raw html ------</div>';

template = `<div class="entry">
	<h1>{{title}}</h1>
	<div class="body">
		{{{body}}}
	</div>
</div>`;


context = {
	title: "All about <p> Tags",
	body: "<p>This is a post about &lt;p&gt; tags</p>"
};

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);

container.innerHTML += '<div class="break-line">------ block expressions ------</div>';

template = `{{#list people}}{{firstName}} {{lastName}}{{/list}}`;

context = {
	people : [
		{ firstName: "Peter", lastName: "Dematté" },
		{ firstName: "Tom", lastName: "Cooper" },
		{ firstName: "Alan", lastName: "Jefferson" }
	]
};

Handlebars.registerHelper('list', function(items, options) {
	var out = "<ul>";

	for(var i=0, l=items.length; i<l; i++) {
		out = out + "<li>" + options.fn(items[i]) + "</li>";
	}
	out = out + "</ul>";
	return out;
});
handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);

container.innerHTML += '<div class="break-line">------ each block helper ------</div>';

template = `<ul class="people_list">
	{{#each people}}
		<li>{{this}}</li>
	{{/each}}
</ul>`;

context = {
	people: [
		"Peter Dematté",
		"Tom Cooper",
		"Alan Jefferson"
	]
};

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);

container.innerHTML += '<div class="break-line">------ if block helper (empty context) ------</div>';

template = `<div class="entry">
	{{#if author}}
		<h1>{{firstName}} {{lastName}}</h1>
	{{/if}}
</div>`;

context = {};

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);

container.innerHTML += '<div class="break-line">------ if block helper (truthy context) ------</div>';

template = `<div class="entry">
	{{#if author}}
		<h1>{{firstName}} {{lastName}}</h1>
	{{/if}}
</div>`;

context = {
	author: true,
	firstName: 'eric',
	lastName: 'blair'
};

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);

container.innerHTML += '<div class="break-line">------ if/else ------</div>';

template = `<div class="entry">
	{{#if author}}
		<h1>{{firstName}} {{lastName}}</h1>
	{{else}}
		<h1>Unknown Author</h1>
	{{/if}}
</div>`;

context = {};

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);

container.innerHTML += '<div class="break-line">------ unless (falsy) ------</div>';

template = `<div class="entry">
	{{#unless license}}
		<h3 class="warning">WARNING: This entry does not have a license!</h3>
	{{/unless}}
</div>`;

context = {};

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);

container.innerHTML += '<div class="break-line">------ unless (truthy) ------</div>';

template = `<div class="entry">
	{{#unless license}}
		<h3 class="warning">WARNING: This entry does not have a license!</h3>
	{{/unless}}
	<h3>License Exists!</h3>
</div>`;

context = { license: true };

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);

container.innerHTML += '<div class="break-line">------ paths - simple/mustache ------</div>';

template = '<p>{{name}}</p>';

context = { name: 'John Denver' };

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);

container.innerHTML += '<div class="break-line">------ paths - nested ------</div>';

template = `<div class="entry">
	<h1>{{title}}</h1>
	<h2>By {{author/name}}</h2>

	<div class="body">
		{{body}}
	</div>
</div>`;

context = {
	title: "My First Blog Post!",
	author: {
		id: 47,
		name: "Peter Dematté"
	},
	body: "My first post. Wheeeee!"
};

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);

container.innerHTML += '<div class="break-line">------ paths - ../ ------</div>';

template = `<h1>Comments</h1>

<div id="comments">
	{{#each comments}}
		<h2><a href="/posts/{{../permalink}}#{{id}}">{{title}}</a></h2>
		<div>{{body}}</div>
	{{/each}}
</div>`;

context = {
	comments: [
		{ id: 1, title: 'wow what a great site'},
		{ id: 2, title: 'i really love handlebars js'}
	],

	body: "Try Schnauzer JS!",
	permalink: "try-handlebars-js-today",
};

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);

container.innerHTML += '<div class="break-line">------ paths - brackets ------</div>';

template = `<p>{{this.content}}</p>
<p>{{this.[10]}}</p>`;

context = { content: 'how can i access a numeric key?', '10':'with brackets!' };

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);

container.innerHTML += '<div class="break-line">------ helpers ------</div>';

template = `<div class="post">
	<h1>By {{fullName author}}</h1>
	<div class="body">{{body}}</div>

	<h1>Comments</h1>

	{{#each comments}}
		<h2>By {{fullName author}}</h2>
		<div class="body">{{body}}</div>
	{{/each}}
</div>`;

context = {
	author: {firstName: "Alan", lastName: "Jefferson"},
	body: "I Love Schnauzer",
	comments: [{
		author: {firstName: "Peter", lastName: "Dematté"},
		body: "Me too!"
	}]
};

Handlebars.registerHelper('fullName', function(person) {
	return person.firstName + " " + person.lastName;
});

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);

container.innerHTML += '<div class="break-line">------ helpers (this context) ------</div>';

template = `<div>
	{{#each items}}
		{{{agree_button}}}
	{{/each}}
</div>`;

context = {
	items: [
		{name: "Schnauzer", emotion: "love"},
		{name: "Mustache", emotion: "enjoy"},
		{name: "SproutCore", emotion: "want to learn"}
	]
};

Handlebars.registerHelper('agree_button', function() {
	return "<button>I agree. I " + this.emotion + " " + this.name + "</button>";
});

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);


container.innerHTML += '<h2> Some additional tests </h2>';
container.innerHTML += '<div class="break-line">------ inline partials ------</div>';

template = `{{#* inline "iterationCount"}}
		<li>I'm iteration #{{value}}, key: {{@key}}, index: {{@index}}</li>
{{/inline}}
{{#each testArray}}
		{{> iterationCount}}
{{/each}}`;

context = {
	testArray: [
		{value: '01'},
		{value: '02'},
		{value: '03'},
	]
};

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);

container.innerHTML += '<div class="break-line">------ decorators 1 (should be empty) ------</div>';

template = `
	loud
	
	{{* shhh foo="ggg"}}`;

Handlebars.registerDecorator('shhh', function(program, props, container, context) {
    var isLoud = program().trim() === 'loud';
    if (isLoud) {
        return function() { return ''; };
    } else {
        return program;
    }
});

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars({});

container.innerHTML += '<div class="break-line">------ decorators 2 ------</div>';

template = `
	{{* activateFormatter "EUR"}}

	Starting amount: {{formatMoneyHelper this.start}}
	Ending amount: {{formatMoneyHelper this.end}}
	Profit/Loss: {{formatMoneyHelper this.net}}`;

context = {
    start: 12.30,
    end: 15.30,
    net: 3.00,
    format: 'USD'
};

function formatUSD(value) {
    return new Handlebars.SafeString('$' + value + 'USD');
}

function formatEUR(value) {
    return new Handlebars.SafeString('€' + value + 'EUR');
}

Handlebars.registerHelper('formatMoneyHelper', function(value, currency) {
    switch(currency) {
        case 'USD':
            return new Handlebars.SafeString('$' + value + 'USD');
        case 'EUR':
            return new Handlebars.SafeString('€' + value + 'EUR');
    }
});

Handlebars.registerDecorator('activateFormatter', function(program, props, container, context) {
    var moneyHelper,
        format = context.args[0] || context.data.root.format;

    switch(format) {
        case "USD":
            moneyHelper = formatUSD;
            break;
        case "EUR":
            moneyHelper = formatEUR;
            break;
        default:
            console.log('Money format not set. Please set before rendering template.');
            moneyHelper = function() {};
    }

    container.helpers['formatMoneyHelper'] = moneyHelper;
});

handlebars = Handlebars.compile(template);
container.innerHTML += handlebars(context);

</script>
</body>
</html>
