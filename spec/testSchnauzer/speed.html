<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

	<script type="text/javascript" src="../../../schnauzer.js"></script>
	<script type="text/javascript" src="_handlebars.js"></script>
	<title>Tree Test</title>
</head>
<body>
<script type="text/template" id="template--">
	{{#* inline "iterationCount"}}
	    <li>I'm iteration #{{value}}, key: {{@key}}, index: {{@index}}</li>
	{{/inline}}
	{{#each testArray}}
	    {{> iterationCount}}
	{{/each}}
</script>
<script type="text/template" id="partial2">
	hhh {{deep.foo}}|{{../deep.foo}}|{{foo}}|
		{{#bar}}
			, {{this}}, {{.}}, {{../bar}}, {{foo}}, {{../foo}}, {{../../foo}}
		{{/bar}}
</script>
<script type="text/template" id="templatess">
	{{#each deep}}{{@last}}
		{{@key}}[{{@index}}]: {{.}}{{#@last}} isLast{{/@last}}
		{{#each ../deep}}{{@last}}{{@../index}}
			{{@key}}[{{@index}}]: {{.}}{{#@last}} isLast{{/@last}}
		{{/each}}
	{{/each}}
</script>
<script type="text/template" id="template">
	{{#if asd}}
		asd
	{{else}}
		no asd
	{{/if}}

	{{>partial foo="foo"}}
	{{#with deep}} 123123123
		{{>partial foo=../help bar=foo}}
	{{/with}}

	{{#if help}}
		--help is present--
		{{#if deep}}
			--deep is present--
			{{#each deep}}
				...{{this}}
			{{/each}}
		{{/if}}
		{{#unless deep}}
			--deep is "not" present--
		{{/unless}}
	{{/if}}
	{{#if deeps}}
		deeps
	{{else}}
		no deeps
	{{/if}}
	{{#unless help}}
		--help is "not" present--
	{{/unless}}
</script>


<script type="text/template" id="partial">
	hhh {{./foo}} | {{foo}} |
	{{#bar}}
	, {{this}}, {{.}}, {{../bar}}, {{foo}}, {{../../foo}},
	{{/bar}}
</script>

<script type="text/template" id="templateawe">
	{{#with deep}} 123123123
		{{>partial foo=../help bar=foo}}
	{{/with}}
</script>

<div id="schnauzer-out"></div>
<div> ----------------------------------------- </div>
<div id="handlebars-out"></div>

<script type="text/javascript">
(function() { 'use strict';

	var schnauzerContainer = document.getElementById("schnauzer-out");
	var handlebarsContainer = document.getElementById("handlebars-out");

	var template = document.getElementById("template").innerHTML;
	var partial = document.getElementById("partial").innerHTML;
	var helper = function($1, $2, options) {
        var out = [];
        if (options) {
            for(var n = 0, l = $1.length; n < l; n++) {
                out.push($1[n]); // this.fn(this);
            }
            return out.concat(8, 9);
        }

        // schnauzer
        var value = this.getData($1);
        var body = this.getBody();

        for(var n = 0, l = value.length; n < l; n++) {
            out.push(value[n]);
        }
        return out.concat(8, 9);
    };
    var shhh = function(program, props, container, context) {
	    var isLoud = program().trim() === 'loud';
	    if (isLoud) {
	        return function() { return ''; };
	    } else {
	        return program;
	    }
	};

	var ifHelper = function(txt, $1) {
		txt = txt.split('{{else}}');
		return !!this.getData($1).value ? txt[0] : txt[1];
	};
	var elseHelper = function() {
		return '{{else}}';
	};

	var data = {
		foo: 'fooValue',
		deep: {
			foo: 'deepFooValue',
			bar: 'deepBarValue',
			// child: {
			// 	foo: 'deepFooValue 22',
			// 	bar: 'deepBarValue 22',
			// }
		},
		help: '--helper--',
		ggg: [1, 2, 3],
		test: [1, 2, 3],
		testArray: [
			{value: '01'},
			{value: '02'},
			{value: '03'},
		],
		title: "My first post!",
		author: {
			firstName: "Charles",
			lastName: "Jolley"
		},
		path: 22,
		helpers: 44,
		extra: 999,

	    start: 12.30,
	    end: 15.30,
	    net: 3.00,
	    format: 'USD'
	};

	var counter = 2000;

	// Handlebars.registerHelper('formatMoneyHelper', formatMoneyHelper);
	// Handlebars.registerDecorator('activateFormatter', activateFormatter);
	// Handlebars.registerHelper('raw-helper', function(options) {
	//   return options.fn();
	// });
	window.addEventListener('go-run', function(e) {
		Handlebars.registerPartial('partial', partial);
		Handlebars.registerHelper('helper', helper);
		Handlebars.registerDecorator('shhh', shhh);
		var handlebars = Handlebars.compile(template);

		for (var n = (e.value || counter); n--; ) {
			handlebars(data);
		}
		handlebarsContainer.innerHTML = handlebars(data);
	});

		Handlebars.registerPartial('partial', partial);
		Handlebars.registerHelper('helper', helper);
		Handlebars.registerDecorator('shhh', shhh);
		var handlebars = Handlebars.compile(template);
		handlebarsContainer.innerHTML = handlebars(data);
	
		// console.log(template);
		var schnauzer = new Schnauzer(template, {
					partials: { partial: partial },
					decorators: { shhh: shhh },
					helpers: { helper: helper }, // , if: ifHelper, else: elseHelper
				});
			// console.log(schnauzer);
	schnauzerContainer.innerHTML = schnauzer.render(data, {root: '#/tree/'});


	// for (var n = counter; n--; ) {
	// 	schnauzer.render(data);
	// }



})();
</script>
</body>
</html>
